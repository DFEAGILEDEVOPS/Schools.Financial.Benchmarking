@using SFB.Web.Common
@using SFB.Web.UI.Helpers.Enums

@model SFB.Web.UI.Models.BenchmarkChartListViewModel

@{
    ViewBag.Title = "Schools Financial Benchmarking";
    ViewBag.pageClass = "benchmarking-charts";
}

@section InsideHead{
    <link href="~/public/assets/print/bmc-print.css" media="print" rel="stylesheet" type="text/css">
    <script src="~/node_modules/jspdf/dist/jspdf.debug.js"></script>
    <script src="~/node_modules/angular/angular.min.js"></script>
}

@section StickyContent
{
    @if (Model.EstablishmentType != EstablishmentType.MAT)
    {
        @Html.Partial("Partials/DesktopStickingBenchmarkListBanner")
    }
}

@section BackButtonContent{
    @Html.Partial("Partials/BackToHomeLink")
}


<div id="BackToBMCharts" class="grid-row hide-in-print" style="display: none">
    <div class="column-full">
        <span class="back-chevron" aria-hidden="true">&#9666;</span>
        <button class="link-button font-xsmall home-link" onclick="location.reload();">Back to benchmarking charts</button>
    </div>
</div>

@if (Model.HasIncompleteFinancialData)
{
    <div class="panel panel-border-wide orange-warning mt-1">
        <div class="shared-icon-wrapper">
            <i class="icon icon-important shared-icon">
                <span class="visually-hidden">Warning</span>
            </i>
        </div>
        <div class="combined-warnings">
            <p>
                Some schools don't have a complete set of financial data for this period
            </p>
        </div>
    </div>
}

<h1 id="BCHeader" class="heading-xlarge page-heading">Quick comparison report</h1>

@if (Model.SchoolComparisonList != null && Model.SchoolComparisonList.BenchmarkSchools.Count == 0)
{
    <div class="panel panel-border-wide orange-warning">
        <p>
            There are no schools in your benchmark basket, so no charts can be displayed.
        </p>
    </div>
}
else
{
    if (Model.SchoolComparisonList != null && !string.IsNullOrEmpty(Model.SchoolComparisonList.HomeSchoolName))
    {
        if (Model.BmSchoolInList())
        {
            <div class="grid-row">
                <div class="column-full" id="comparing-text">
                    <span>Comparing</span>
                    <div class="highlight">
                        <a href="/school/detail?Urn=@Model.SchoolComparisonList.HomeSchoolUrn"> <span class="bold-small">@Model.SchoolComparisonList.HomeSchoolName</span></a>
                    </div>
                    <span>&nbsp;using </span><span class="bold-xsmall">Quick report characteristics</span><span>.</span>
                </div>
            </div>
        }
    }

    <div class="grid-row">
        <div class="column-full">
            <details class="criteria-details">
                <summary class="hide-in-print">
                    <span class="summary font-xsmall">View characteristics used</span>
                </summary>
                <div class="panel panel-border-narrow criteria-detail">
                    @Html.Partial("Partials/UsedOneClickCriteria")
                </div>
            </details>
        </div>
    </div>

    <div class="grid-row download-links hide-in-print">
        <div id="downloadLinkContainer" class="download-link">
            <div class="download">
                <a id="DownloadLink" class="no-underline bold-xsmall sfb_gtm_csv_bm" href="/BenchmarkCharts/Download?type=@Model.EstablishmentType">
                    <img class="icon" src="~/public/assets/images/icons/icon-file-download.png" alt="" /><span id="DownloadLinkText"> Download benchmark data (CSV)</span>
                </a>
            </div>
        </div>
        <div class="download-link">
            <div class="print">
                <button id="PrintLink" class="no-underline bold-xsmall link-button" onclick="DfE.Views.BenchmarkChartsViewModel.PrintPage()">
                    <img class="icon" src="~/public/assets/images/icons/icon-print.png" alt="" /><span id="PrintLinkText"> Print page</span>
                </button>
            </div>
        </div>
        <div class="download-link">
            <div class="pdf">
                <button id="PdfLink" class="no-underline bold-xsmall link-button" onclick="DfE.Views.BenchmarkChartsViewModel.PdfPage()">
                    <img class="icon download-icon" src="~/public/assets/images/icons/icon-file-download.png" alt="" />
                    <img class="icon spin-icon" src="~/public/assets/images/spinner.gif" alt="" style="display: none" />
                    <span id="PrintLinkText"> Download PDF</span>
                </button>
            </div>
        </div>
    </div>

    <div class="charts-section">
        <div class="grid-row">
            <div class="column-full font-xsmall chartTable hide-in-print">
                <button style="display: @Html.Raw(ViewBag.ChartFormat == ChartFormat.Tables ? "block" : "none")" class="view-charts-tables charts no-underline link-button font-xsmall" onclick="DfE.Views.BenchmarkChartsViewModel.ToggleChartsTables('Charts')"><img class="icon" src="~/public/assets/images/icons/icon-chart.png" alt="" /><span> View as charts</span></button>
                <button style="display: @Html.Raw(ViewBag.ChartFormat == ChartFormat.Tables ? "none" : "block")" class="view-charts-tables tables no-underline link-button font-xsmall" onclick="DfE.Views.BenchmarkChartsViewModel.ToggleChartsTables('Tables')"><img class="icon" src="~/public/assets/images/icons/icon-list.png" alt="" /><span> View as tables</span></button>
            </div>
        </div>
        <div class="font-xsmall latest-year-message">
            <span>The data below is from the latest year available. For maintained schools this is <span class="bold-xsmall">@Model.LatestTermMaintained</span>, academies from <span class="bold-xsmall">@Model.LatestTermAcademies</span></span>
        </div>
        <hr />
        <div id="benchmarkChartsList" class="one-click-charts">
            @Html.Partial("~/Views/BenchmarkCharts/Partials/Chart.cshtml", Model.ModelList)
        </div>
    </div>

    <a href="#pagetop" class="page-top hide-in-print">Back to top</a>

    <input type="hidden" id="Type" name="Type" value="@Model.EstablishmentType" />
    <input type="hidden" id="ComparisonType" name="Type" value="@Model.ComparisonType" />
    <input type="hidden" id="HomeSchoolName" name="HomeSchoolName" value="@Html.Raw(Model.EstablishmentType == EstablishmentType.MAT ? Model.TrustComparisonList.DefaultTrustName : Model.SchoolComparisonList.HomeSchoolName)" />

}

@section AfterMain{
    <div class="full-page-width-wrapper hide-in-print" role="region" aria-label="Feedback Question">
        <div class="improve-this-page" data-module="improve-this-page">
            <div class="improve-this-page__prompt js-prompt clearfix" tabindex="-1">
                <span class="improve-this-page__is-useful-question bold">Are you satisfied with your visit today?</span>
                <a rel="external noopener noreferrer" target="_blank" title="Feedback form will open in a new page" href="http://www.smartsurvey.co.uk/s/schoolsfinancialbenchmarkingsite/">Please rate this site</a>
            </div>
        </div>
    </div>
}

@section ViewScripts {

    <script src="~/node_modules/d3/d3.min.js"></script>
    <script src="~/node_modules/c3/c3.min.js"></script>
    <script src="~/node_modules/lodash/lodash.min.js"></script>
    <script src="~/public/scripts/jquery-tablesorter/jquery.tablesorter.uk.currency.js"></script>
    <script src="~/public/scripts/saveSvgAsPng-gh-pages/saveSvgAsPng.js"></script>
    <script src="~/public/scripts/saveSvgAsPng-gh-pages/rgbcolor.js"></script>
    <script src="~/public/scripts/saveSvgAsPng-gh-pages/StackBlur.js"></script>
    <script src="~/public/scripts/saveSvgAsPng-gh-pages/canvg.js"></script>

    <script>
        DfE.Views.BenchmarkChartsViewModel = new BenchmarkChartsViewModel();
    </script>

}
